# Медиана медиан

## Что это такое?
Это оптимизация выбора опорного элемента, которая даст нам возможность в худшем случае сортировать массив быстрой
сортировкой за $O(N \log N)$ вреени.

## Алгоритм 
1. Разобьем массив на пятерки элементов.
2. В каждой пятерке выберем медиану. Получили массив медиан.
3. Для массива медиан рекурсивно строим массив его медиан, пока не сойдемся к одному элементу. Его назовем медианой медиан.

## В чем преимущества медианы медиан?
Медтана медиан делит массив гарантированно не хуже, чем $3:7$
#### Доказательство:
Cначала определим нижнюю границу для количества элементов, превышающих по величине опорный элемент $x$. В общем случае
как минимум половина медиан, найденных на втором шаге, больше или равны медианы медиан $x$. Таким образом, как минимум $N/10$ групп содержат по $3$ элемента, превышающих величину $x$, за  исключением группы, в которой меньше $5$ элементов и ещё одной
группы, содержащей сам элемент $x$. Таким образом получаем, что количество элементов больших $x$ не менее $3n 10$ .
#### Пример
Имеем, массив 45 чисел, делим его на 9 групп по 5 элементов получаем, сортируем эти 5 элментов

| 1ая| 2ая| 3ая| 4ая| 5ая| 6ая| 7ая| 8ая| 9ая|     
|----|----|----|----|----|----|----|----|----|
| 48 | 43 | 38 | 33 | 28 | 23 | 18 | 13 | 8  |
| 49 | 44 | 39 | 34 | 29 | 24 | 19 | 14 | 9  |
| 50 | 45 | 40 | 35 | 30 | 25 | 20 | 15 | 10 |
| 51 | 46 | 41 | 36 | 31 | 26 | 21 | 16 | 53 |
| 52 | 47 | 42 | 37 | 32 | 27 | 22 | 17 | 54 |

На 3 рду находятся медианы всех пятерок, медиана медиан находится в середине $3$ ряда, т. е. на $5$ столбце. 
Мы хотим получить pivot, который разделает список, как можно ровнее. В худшем возможном случае каждый элемент 
в слева вверху будет меньше или равен pivot. Верхний правый прямоугольник содержит $3/5$ половины строк — 3/5*1/2=3/10. 
Поэтому на каждом этапе мы избавляемся по крайней мере от $30%$ строк.
Хватит ли 30% для того, чтобы 
--- Выполнять работу O(n) по разбиению элементов
--- Для рекурсии решать одну подзадачу размером в 7⁄10 от исходной
--- Для вычисления медианы медиан решать одну подзадачу размером с 1⁄5 от исходной
В результате мы получаем следующее уравнение полного времени выполнения T(n):

$T(n) = T(n / 5) + 7T(n / 10) + n$
Мы попадаем в третий случай теоремы, при котором работа на каждом уровне доминирует над работой подзадач. В этом случае общая работа будет просто равна работе на каждом уровне, то есть O(n).


